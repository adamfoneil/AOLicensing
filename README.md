This is an overhaul of a previous desktop app licensing solution I did about a year ago using Azure Functions, Azure Table Storage, and PayPal integration. This is really for my internal use, not a general-purpose reusable solution. But you should still get plenty of ideas on how to approach this looking my solution.

In this iteration, I've dropped the PayPal integration, and switched to blob storage. IMO blob storage is easier to work with than table storage, and will be good enough for this application. I'm expecting such low (if any) sales volume that I'm going to manually create license keys from a [console app](https://github.com/adamfoneil/AOLicensing/tree/master/AOLicensing.KeyManager). The desktop gatekeeping is still in place. PayPal's developer story has gotten complicated, and it seems they no longer support the old-school IPN (instant payment notification) based on simple form posts and callbacks. I have a PayPal [handler](https://github.com/adamfoneil/PayPalHelper2) that I like. But like I say their story has become an forest of endless JavaScript, and I'm not having it.

- The [Function](https://github.com/adamfoneil/AOLicensing/tree/master/AOLicensing.Functions) project has these functions:
  - [CreateKey](https://github.com/adamfoneil/AOLicensing/blob/master/AOLicensing.Functions/CreateKey.cs) creates keys and saves them in blob storage with a customer's email address. I will trigger this manually from a console app when I get a payment notification. I will still use PayPal, but without IPN integration. This requires `Function` level permission because not just anyone can create keys.
  - [ValidateKey](https://github.com/adamfoneil/AOLicensing/blob/master/AOLicensing.Functions/ValidateKey.cs) is called from the [Gatekeeper](https://github.com/adamfoneil/AOLicensing/blob/master/AOLicensing.Desktop/Gatekeeper.cs#L99) class. This [allows anonymous](https://github.com/adamfoneil/AOLicensing/blob/master/AOLicensing.Functions/ValidateKey.cs#L21) access because anyone can validate a key.
  - [QueryKey](https://github.com/adamfoneil/AOLicensing/blob/master/AOLicensing.Functions/QueryKey.cs) is used to help a customer find a lost key. Requires admin access.
  
- The [Desktop](https://github.com/adamfoneil/AOLicensing/tree/master/AOLicensing.Desktop) project is delivered as a NuGet package used in desktop apps. This is what I use to see if a product is activated. Apps would call [StartLicensing](https://github.com/adamfoneil/AOLicensing/blob/master/AOLicensing.Desktop/Gatekeeper.cs#L36) to see if they are licensed.

- The [Shared](https://github.com/adamfoneil/AOLicensing/tree/master/AOLicensing.Shared) project has [Models](https://github.com/adamfoneil/AOLicensing/tree/master/AOLicensing.Shared/Models) used both in the Deskop and Function projects. Note that the Desktop project uses [linked](https://github.com/adamfoneil/AOLicensing/blob/master/AOLicensing.Desktop/AOLicensing.Desktop.csproj#L18-L22) members from the Shared project. Due to limitations of NuGet packaging, you can't include referenced projects. The next best thing is to link source files from the originating project, so that's what I do.
  - This offers an API [client](https://github.com/adamfoneil/AOLicensing/blob/master/AOLicensing.Shared/LicensingClient.cs) made with Refit, using this [interface](https://github.com/adamfoneil/AOLicensing/blob/master/AOLicensing.Shared/Interfaces/ILicensingClient.cs).

- The [KeyManager](https://github.com/adamfoneil/AOLicensing/tree/master/AOLicensing.KeyManager) project is the console app I'll use to interact with my key storage. I would use this if someone buys a license and need a key generated. I used to automate this with PayPal IPN, but my sales volume is so low, and PayPal has so gotten complicated that I would rather generate keys manually. (My workload is still very low as the backend function [generates](https://github.com/adamfoneil/AOLicensing/blob/master/AOLicensing.Functions/CreateKey.cs#L39) and [sends](https://github.com/adamfoneil/AOLicensing/blob/master/AOLicensing.Functions/CreateKey.cs#L65) the key.)
